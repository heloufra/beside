<!-- nav -->
<!-- sub-container-nav-bar-profile-dropdown-mask -->
    <div class="sub-container-nav-bar-profile-dropdown-mask">
        <div class="sub-container-nav-bar-profile-dropdown">
                    <!--  sections-main-sub-container-left-cards  -->
                    <div class="sections-main-sub-container-left-card">
                          <img class="sections-main-sub-container-left-card-main-img user_image" src="<%= user.User_Image %>">
                          <div class="sections-main-sub-container-left-card-info">
                               <% 
                                  var userNAme = user.User_Email.slice(0,10) + "...";
                                    try {
                                        userNAme = JSON.parse(user.User_Name);
                                        if (userNAme.first_name)
                                          userNAme = userNAme.first_name + " " + userNAme.last_name;
                                        else
                                          userNAme = user.User_Email.slice(0,10) + "...";
                                    } catch (e) {
                                        userNAme = user.User_Email.slice(0,10) + "...";
                                    }
                              %>
                              <p class="sections-main-sub-container-left-card-main-info user_name" ><%= userNAme %></p>
                              <span  class="sections-main-sub-container-left-card-sub-info" data-lang="<%= role %>"><%= role %></span>
                          </div>
                    </div>
                    <!--  End sections-main-sub-container-left-cards  -->

                    <!--  sub-container-nav-bar-profile-dropdown-ul  -->
                    <ul class="sub-container-nav-bar-profile-dropdown-ul">
                      <% if (role !== 'Student') {%>
                      
                      <% if (users.length > 1 ) {%>
                      <li class="sub-container-nav-bar-profile-dropdown-ul-li">
                        <a href="" data-lang="Switch_account">Switch Accounts</a>
                        <img src="assets/icons/caret.svg" class="caret-img" alt="caret"/>
                        
                          <!--  sub-container-nav-bar-profile-dropdown-ul  -->
                          <div class="sub-container-nav-bar-profile-dropdown-ul sub-container-nav-bar-profile-dropdown-sub-ul">
                             <% for(var i=0; i<users.length; i++) {%>
                                  <%  var name = users[i].User_Email.slice(0,10) + "...";
                                    try {
                                        name = JSON.parse(users[i].User_Name);
                                        if (name.first_name)
                                          name = name.first_name + " " + name.last_name;
                                        else
                                          name = users[i].User_Email.slice(0,10) + "...";
                                    } catch (e) {
                                        name = users[i].User_Email.slice(0,10) + "...";
                                    }

                                  %>
                                  <a href="#" data-id="<%=users[i].User_ID %>" data-role="<%=users[i].role %>" class="role">
                                        <!--  sections-main-sub-container-left-cards  -->
                                        <div class="sections-main-sub-container-left-card">
                                              <img class="sections-main-sub-container-left-card-main-img user_image" src="<%= users[i].User_Image %>" alt="card-img">
                                              <div class="sections-main-sub-container-left-card-info">
                                                  <p class="sections-main-sub-container-left-card-main-info user_name"><%= name %></p>
                                                  <span  class="sections-main-sub-container-left-card-sub-info" data-lang="<%= users[i].role %>"><%= users[i].role %></span>
                                              </div>
                                        </div>
                                        <!--  End sections-main-sub-container-left-cards  -->
                                  </a>
                              <% } %>
                          </div>
                          <!--  End sub-container-nav-bar-profile-dropdown-ul -->
                      </li>
                      <% } %>
                      <li><a href="#" id="settings_btn" data-lang="Account_settings">Account Settings</a></li>
                      <%}%>
                      <li><a href="/logout" id="logout_btn_" data-lang="Logout">Logout</a></li>
                    </ul>
                    <!--  End sub-container-nav-bar-profile-dropdown-ul -->

                    <img class="sub-container-nav-bar-profile-dropdown-close" alt="close" src="assets/icons/close.svg">

        </div>
    </div>
    <!-- End sub-container-nav-bar-profile-dropdown-mask -->

<!-- nav -->
<script>
var pathname = window.location.pathname.replace('/','');
$(document).on("click","#logout_btn",function(event){

    $.ajax({type: 'get',url: '/logout'}).done(function(res){
      if (res.logout)
        window.location.href = "/";
    });

});

function readFile() {
  
  if (this.files && this.files[0]) {
    
    var FR= new FileReader();
    
    FR.addEventListener("load", function(e) {
      document.getElementById("output-settings").src = e.target.result;
    }); 
    
    FR.readAsDataURL( this.files[0] );
  }
  
}


// sendConfirmationPassword

function sendConfirmationPassword($email){
	// test if phone or email exist 
	$.ajax({
	        type: 'post',
	        url: '/verify',
	        data: {
	          email:$email,
	          updateProfile:true
	        },
	        dataType: 'json'
	})
}

$(document).on("click","#settings_btn",function(event){
    document.getElementById("profile_settings").addEventListener("change", readFile);
    
    $('#ProfileSettings').addClass('data-loading');
    $('#ProfileSettings').modal('show'); 

     $.ajax({
      type: 'get',
      url: '/Select/me',
    })
    .done(function(res){

      $('#ProfileSettings').find('#output-settings').attr('src',res.user.User_Image);
         var name = JSON.parse(res.user.User_Name);
      
      $('#ProfileSettings').find('input[name=fname-settings]').val(name.first_name);
      $('#ProfileSettings').find('input[name=lname-settings]').val(name.last_name);
      $('#ProfileSettings').find('input[name=date-settings]').val(res.user.User_Birthdate);
      $('#ProfileSettings').find('input[name=address-settings]').val(res.user.User_Address);
      $('#ProfileSettings').find('input[name=phone-settings]').val(res.user.User_Phone);
      $('#ProfileSettings').find('input[name=email-settings]').val(res.user.User_Email);
      $('#ProfileSettings').find('input[name=gender-settings]').val(res.user.User_Gender);

      // send Update Info Confirmation Password
      sendConfirmationPassword(res.user.User_Email); 

      $('#ProfileSettings').removeClass('data-loading');
      
    });

});



$(document).on("click",".role",function(event){
     $.ajax({
      type: 'post',
      url: '/Select/roles',
      data:{
      role:$(this).data('role')
      },
      dataType: 'json'
    })
    .done(function(res){
      if(res.switched)
      {
        window.location.href = "/home";
      } else {
       console.log(res.errors)
      }
    });
});

</script>